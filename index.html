<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Medical Help</title>
</head>
<body>
<h2>Smart Medical Help Form</h2>

<label for="location">Location:</label>
<input type="text" id="location" placeholder="Enter your location"><br><br>

<label for="problem">Problem:</label>
<input type="text" id="problem" placeholder="Enter problem"><br><br>

<button id="sendBtn">Send Help Request</button>

<h3>Status: <span id="status">Disconnected</span></h3>
<h3>Response from ESP32: <span id="response"></span></h3>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
const statusEl = document.getElementById('status');
const responseEl = document.getElementById('response');

// HiveMQ WSS broker
const broker = 'wss://broker.hivemq.com:8000/mqtt';
const options = {
  clientId: 'WebClient_' + Math.random().toString(16).substr(2, 8),
  keepalive: 60,
  clean: true,
  reconnectPeriod: 1000
};

const client = mqtt.connect(broker, options);

client.on('connect', () => {
  statusEl.textContent = 'Connected';
  console.log('Connected to MQTT broker');
  client.subscribe('smartmedical/response', (err) => {
    if(!err) console.log('Subscribed to smartmedical/response');
  });
});

client.on('message', (topic, message) => {
  if(topic === 'smartmedical/response') {
    responseEl.textContent = message.toString();
  }
});

client.on('error', (err) => {
  statusEl.textContent = 'Error';
  console.error('Connection error:', err);
});

document.getElementById('sendBtn').addEventListener('click', () => {
  const location = document.getElementById('location').value.trim();
  const problem = document.getElementById('problem').value.trim();
  if(location && problem){
    const payload = `HELP:${location}:${problem}`;
    client.publish('smartmedical/help', payload);
    alert('Help request sent!');
  } else {
    alert('Please fill in both location and problem.');
  }
});
</script>
</body>
</html>

