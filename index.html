<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Medical Help</title>
</head>
<body>
<h2>Smart Medical Help Form</h2>

<label>Location:</label>
<input type="text" id="location"><br><br>

<label>Problem:</label>
<input type="text" id="problem"><br><br>

<label>Phone Number:</label>
<input type="text" id="phone"><br><br>

<button id="sendBtn">Send Help Request</button>

<h3>Status: <span id="status">Disconnected</span></h3>
<h3>Response from Medical Center: <span id="response"></span></h3>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
const statusEl = document.getElementById('status');
const responseEl = document.getElementById('response');

const broker = 'wss://5d50781512bf470b8b7f638f0c140138.s1.eu.hivemq.cloud:8884/mqtt';
const options = {
  clientId: 'WebClient_' + Math.random().toString(16).substr(2,8),
  username: 'hivemq.webclient.1759059787763',
  password: 'De0y4!TzE7t#Z<5Wo>Hq',
  keepalive:60,
  clean:true,
  reconnectPeriod:1000
};

const client = mqtt.connect(broker, options);

client.on('connect',()=>{
  statusEl.textContent='Connected';
  console.log('Connected to broker');
  client.subscribe('smartmedical/response');
});

client.on('message',(topic,message)=>{
  if(topic==='smartmedical/response'){
    responseEl.textContent=message.toString();
  }
});

client.on('error',(err)=>{
  statusEl.textContent='Error';
  console.error(err);
});

document.getElementById('sendBtn').addEventListener('click',()=>{
  const location=document.getElementById('location').value.trim();
  const problem=document.getElementById('problem').value.trim();
  const phone=document.getElementById('phone').value.trim();

  if(location && problem && phone){
    const payload=HELP:${location}:${problem}:${phone};
    client.publish('smartmedical/help',payload);
    alert('Help request sent!');
  }else{
    alert('Fill all fields!');
  }
});
</script>
</body>
</html>
